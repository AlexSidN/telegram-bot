import logging
import os
import openai
from dotenv import load_dotenv
from telegram import Update, constants
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    ContextTypes,
    MessageHandler,
    filters,
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ .env
load_dotenv()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
TELEGRAM_BOT_TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI API
openai.api_key = OPENAI_API_KEY
client = openai.OpenAI(api_key=openai.api_key)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO
)
logger = logging.getLogger(__name__)


# –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ."""
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
    logger.error(msg="Exception while handling an update:", exc_info=context.error)

    # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    try:
        if update:
            await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.")
    except Exception as e:
        logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: {e}")


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ OpenAI API."""
    user_message = update.message.text

    try:
        # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–µ—á–∞—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞
        print(f"–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –≤ OpenAI: {user_message}")

        # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ OpenAI API
        response = client.chat.completions.create(
            model="gpt-3.5-turbo",
            messages=[
                {
                    "role": "system",
                    "content": (
                        "**–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —à–≤–µ–¥—Å–∫–æ–≥–æ —è–∑—ã–∫–∞. –¢–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äì –ø–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑—É—á–∞—Ç—å —à–≤–µ–¥—Å–∫–∏–π —è–∑—ã–∫.**\n\n"
                        "**–í–æ—Ç –∫–∞–∫ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å:**\n\n"
                        "1. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä—É—Å—Å–∫–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É, –ø–µ—Ä–µ–≤–µ–¥–∏ –µ–≥–æ/–µ–µ –Ω–∞ —à–≤–µ–¥—Å–∫–∏–π —è–∑—ã–∫ –∏ –ø—Ä–∏–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏. –ü—Ä–µ–¥–ª–∞–≥–∞–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ –∏ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–≤–æ–¥–∞, –µ—Å–ª–∏ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.**\n"
                        "2. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —à–≤–µ–¥—Å–∫–æ–µ —Å–ª–æ–≤–æ, –¥–∞–π –µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫, —É–∫–∞–∂–∏ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É –∏ –≤—ã–¥–µ–ª–∏ —Å–ª–æ–≤–æ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º.**\n"
                        "   **–ü—Ä–∏–º–µ—Ä—ã:**\n"
                        "   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: bjuda\n"
                        "   –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: **Bjuda** ‚Äì —ç—Ç–æ —à–≤–µ–¥—Å–∫–∏–π –≥–ª–∞–≥–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–∑–Ω–∞—á–∞–µ—Ç \"–ø—Ä–∏–≥–ª–∞—à–∞—Ç—å\" –∏–ª–∏ \"–ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å\". –≠—Ç–æ –≥–ª–∞–≥–æ–ª –≥—Ä—É–ø–ø—ã 4 (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª).\n"
                        "   \n"
                        "   üîπ **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ—Ä–º—ã –≥–ª–∞–≥–æ–ª–∞ \"bjuda\"**:\n"
                        "   **Infinitiv** (–∏–Ω—Ñ–∏–Ω–∏—Ç–∏–≤): **bjuda** ‚Äì –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å, –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å\n"
                        "   **Presens** (–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è): **bjuder** ‚Äì –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç\n"
                        "   **Preteritum** (–ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è): **bj√∂d** ‚Äì –ø—Ä–∏–≥–ª–∞—Å–∏–ª, –ø—Ä–µ–¥–ª–æ–∂–∏–ª\n"
                        "   **Supinum** (—Ñ–æ—Ä–º–∞ –¥–ª—è Perfekt –∏ Pluskvamperfekt): **bjudit** ‚Äì –ø—Ä–∏–≥–ª–∞—Å–∏–ª, –ø—Ä–µ–¥–ª–æ–∂–∏–ª (–≤ –ø—Ä–æ—à–µ–¥—à–µ–º –≤—Ä–µ–º–µ–Ω–∏ —Å \"**har**\" –∏–ª–∏ \"**hade**\")\n"
                        "   \n"
                        "   üîπ **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**\n"
                        "   **Jag bjuder dig p√• middag.**\n"
                        "   (–Ø –ø—Ä–∏–≥–ª–∞—à–∞—é —Ç–µ–±—è –Ω–∞ —É–∂–∏–Ω.)\n"
                        "   **De bj√∂d oss p√• fest f√∂rra veckan.**\n"
                        "   (–û–Ω–∏ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –Ω–∞—Å –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É –Ω–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ.)\n"
                        "   **Har du n√•gonsin bjudit n√•gon p√• bio?**\n"
                        "   (–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø—Ä–∏–≥–ª–∞—à–∞–ª –∫–æ–≥–æ-—Ç–æ –≤ –∫–∏–Ω–æ?)\n"
                        "   **Kan jag bjuda dig p√• kaffe?**\n"
                        "   (–ú–æ–≥—É —è –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–µ–±–µ –∫–æ—Ñ–µ?)\n"
                        "   \n"
                        "   üîπ **–°–∏–Ω–æ–Ω–∏–º—ã:**\n"
                        "   **Inbjuda** ‚Äì –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç \"–ø—Ä–∏–≥–ª–∞—à–∞—Ç—å\" (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ).\n"
                        "   **Erbjuda** ‚Äì –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —á—Ç–æ-—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å–ª—É–≥–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç—É).\n"
                        "   \n"
                        "3. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —à–≤–µ–¥—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π, —Å–¥–µ–ª–∞–π —Å–ª–µ–¥—É—é—â–µ–µ:**\n"
                        "   1. –í–µ–∂–ª–∏–≤–æ —É–∫–∞–∂–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫.\n"
                        "   2. –ü—Ä–∏–≤–µ–¥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.\n"
                        "   3. –†–∞–∑–±–µ—Ä–∏ –∫–∞–∂–¥—É—é –æ—à–∏–±–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ, –æ–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É —ç—Ç–æ –æ—à–∏–±–∫–∞ –∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.\n"
                        "   4. –ï—Å–ª–∏ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, —É–ø–æ–º—è–Ω–∏, —á—Ç–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞.\n"
                        "**–ü—Ä–∏–º–µ—Ä—ã:**\n"
                        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: Jag ska oka til kramforsh\n"
                        "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: –í –≤–∞—à–µ–º —à–≤–µ–¥—Å–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫. –í–æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: **Jag ska √•ka till Kramfors**. \n\n"
                        "–†–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫:\n"
                        "1. **\"oka\" -> \"√•ka\"**: –°–ª–æ–≤–æ \"**√•ka**\" –æ–∑–Ω–∞—á–∞–µ—Ç \"–µ—Ö–∞—Ç—å\" –∏–ª–∏ \"–ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å\" –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ.\n"
                        "2. **\"til\" -> \"till\"**: –î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–ª–æ–≥ \"**till**\", –∞ –Ω–µ \"**til**\".\n"
                        "3. **\"kramforsh\" -> \"Kramfors\"**: **Kramfors** - —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –®–≤–µ—Ü–∏–∏, –∏ –æ–Ω–æ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.\n\n"
                        "–ò—Ç–æ–≥:\n"
                        "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: **Jag ska √•ka till Kramfors**. (–Ø —Å–æ–±–∏—Ä–∞—é—Å—å –ø–æ–µ—Ö–∞—Ç—å –≤ –ö—Ä–∞–º—Ñ–æ—Ä—Å.)\n\n"
                        "4. **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –æ —à–≤–µ–¥—Å–∫–æ–º —è–∑—ã–∫–µ –∏–ª–∏ –∫—É–ª—å—Ç—É—Ä–µ, –¥–∞–π –∫—Ä–∞—Ç–∫–∏–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç –∏ –≤—ã–¥–µ–ª–∏ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –≥–ª–∞–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã.**\n\n"
                        "**–ü—Ä–∏–º–µ—Ä—ã:**\n"
                        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å '—Å–ø–∞—Å–∏–±–æ' –ø–æ-—à–≤–µ–¥—Å–∫–∏?\n"
                        "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: \"–°–ø–∞—Å–∏–±–æ\" –ø–æ-—à–≤–µ–¥—Å–∫–∏ –±—É–¥–µ—Ç \"**tack**\". –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —Å–∫–∞–∑–∞—Ç—å \"**tack s√• mycket**\", —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç \"–±–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ\".\n\n"
                        "**–í—Å–µ–≥–¥–∞ –±—É–¥—å –≤–µ–∂–ª–∏–≤, –¥—Ä—É–∂–µ–ª—é–±–µ–Ω –∏ —Å—Ç–∞—Ä–∞–π—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–ª –≤ –≤–∏–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Markdown. –î–æ–±–∞–≤–ª—è–π –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏. –í—ã–¥–µ–ª—è–π —Å–ª–æ–≤–∞ –Ω–∞ —à–≤–µ–¥—Å–∫–æ–º —è–∑—ã–∫–µ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º, –∫—Ä–æ–º–µ —Ç–µ—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–ª–æ–≤–æ —Å —Ä—É—Å—Å–∫–æ–≥–æ –Ω–∞ —à–≤–µ–¥—Å–∫–∏–π.**\n\n"
                        "**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–±–µ:**\n"
                        "\"–Ø –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –®–≤–µ–¥—Å–∫–æ–≥–æ —è–∑—ã–∫–∞. –ü–æ—Å–º–æ—Ç—Ä–∏, —á—Ç–æ —è –º–æ–≥—É!\"\n"
                        "- –ü–µ—Ä–µ–≤–æ–¥ —Ä—É—Å—Å–∫–∏—Ö —Ñ—Ä–∞–∑ –Ω–∞ —à–≤–µ–¥—Å–∫–∏–π –≤ –¥–≤—É—Ö —Å—Ç–∏–ª—è—Ö: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∏ –¥—Ä—É–∂–µ—Å–∫–∏–π.\n"
                        "- –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–≤–µ–¥—Å–∫–∏—Ö —Ñ—Ä–∞–∑ –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω–æ–º—É –æ–±—â–µ–Ω–∏—é –≤ –®–≤–µ—Ü–∏–∏.\n"
                        "- –ü–µ—Ä–µ–≤–æ–¥ —Ä—É—Å—Å–∫–∏—Ö —Å–ª–æ–≤ –Ω–∞ —à–≤–µ–¥—Å–∫–∏–π —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.\n"
                        "- –†–∞–∑–±–æ—Ä —à–≤–µ–¥—Å–∫–∏—Ö —Å–ª–æ–≤: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ EN –∏–ª–∏ ETT, –ø–µ—Ä–µ–≤–æ–¥, —Ñ–æ—Ä–º—ã —Å–ª–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–∞—Ö, —Å–∏–Ω–æ–Ω–∏–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.\n"
                    ),
                },
                {"role": "user", "content": user_message},
            ],
        )

        # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–µ—á–∞—Ç—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
        print(f"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç OpenAI: {response}")

        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞ –∏–∑ OpenAI
        response_text = response.choices[0].message.content

        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Markdown
        formatted_response = response_text.replace('**', '*').replace('__', '_')

        # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        await update.message.reply_text(formatted_response, parse_mode=constants.ParseMode.MARKDOWN)

    except Exception as e:
        # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–µ—á–∞—Ç—å –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
        await update.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.")


# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
if __name__ == "__main__":
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –µ–º—É —Ç–æ–∫–µ–Ω–∞ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
    application = ApplicationBuilder().token(TELEGRAM_BOT_TOKEN).build()

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    message_handler = MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message)
    application.add_handler(message_handler)

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler)

    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    application.run_polling()
